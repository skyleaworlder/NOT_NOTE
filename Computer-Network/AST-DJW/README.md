# 复习

这是我为计算机网络期末考试准备的复习指导。

我觉得内容还算详细，但这并不妨碍本人又拿了一个良。

1. 填空题（每空 0.5 分，共 10 分）
2. 单项选择题（每题 2 分，共 40 分）
3. 大题（7 题，共 50 分）

## 大题复习指导

### 1. 数据帧中序号字段的长度设置

帧序号是用于防止 **接受方多次收到同一帧** 的办法。而这里指的 **帧序号长度设置**，是在 **数据链路层滑动窗口** 中出现的，例见课件 87 页。

帧序号位数假设为 $n\ bit$，那么滑动窗口 **可容许的大小** 就为 $2^n$。

滑动窗口的设置有如下规则：

* 发送流量 $\le$ 接收流量（但不意味着发送窗口 $\le$ 接收窗口）；
* 按理说发送端设置发送窗口、接收端设置接收窗口，但全双工通信需要双方都设置两个窗口；
* 发送窗口的大小可以改变，但是不能超过预设的 **最大尺寸**；这个 **最大尺寸** 又有窗口设置上的 **最大限制**（$2^n$）；
* 接收窗口大小始终固定，但这个固定好的 **尺寸** 一定不能超过窗口设置的 **最大限制**（$2^n$）。

#### i. 滑动窗口的精髓

相较于一般的停-等协议，滑动窗口旨在提高链路的 **利用率**。怎么提高呢？在停-等协议中，发送端发送出去一个帧后，需要等到该帧的确认帧返回后，才再发送下一帧。这之间，就有一个基于 **传输时延** 空闲时间。

如果传输时延设为 $\tau_t$，接收方处理帧的时间为 $\tau_p$，那么空闲时间 $RTT$ 就是 $2\tau_t + \tau_p$。

对于一条链路，它的 **最大传输带宽** 是有限制的。那么就可以根据 **带宽、RTT(Round-Trip Time) 和 数据帧大小** 来设计滑动窗口。

#### ii. 例题

```chinese
一条带宽为 1.6Mbps 的链路，往返时延为 45ms，数据帧大小为 1KB。
用滑动窗口尽可能提高利用率，求帧序号长度。

该链路发送一帧需要：1KB * 8 = 8Kb; 8Kb / 1.6Mbps = 5ms。
往返时延中可发：45ms / 5ms = 9 帧。总共可连续发送 1 + 9 = 10 帧
因此帧序号长度可为：ceil(log_2(9)) = 4bit
```

（注：这个时延自然是从 **完全发出去** 之后才开始算的，时延内可发 9 帧，加上最开始的就是 10 帧了）

同时，还可能从另外一个角度考虑——“管道” 中数据量。
通常使用带宽时延积来作为评估 “管道” 中最大数据量的指标。可见第三章课件 93 页。

```chinese
一个 4Mbps 点到点链路，节点间距离 5000km，数据帧大小为 1KB。
信号传播速度为 3×10^8 m/s，设计选择性重传滑动窗口协议。求 “管道满载” 时，最小的序号长度。

RTT = 10^7 m / 3×10^8 m/s = (100/3)ms
带宽时延积为：(100/3)ms × 0.5MBps = (50/3)KB
总共可连续发：(50/3)KB / 1KB = 50/3 = 16
（向下取整是因为只能发整个包，和帧序号位数必须 “对数结果向上取整” 不一样）
帧序号长度最小为：ceil(log_2(16)) = 4
```

### 2. 交换技术：电路交换、报文交换和分组交换，计算总延迟

第二章课件 129 页开始。

#### i. 电路交换

需要建立起来一条 **专用物理连接线路**，传输结束后才释放。那么建立这个链路是需要时间的，而且时间还不短。

发送一条信息，从打算建立电路开始，需要花费（建立电路+发送数据（传输时延）+数据传输（传播时延））这样三部分延迟时间。

#### ii. 报文交换

不多说。估计不会怎么考，因为就是简单的 **存储-转发**。由于是一个一个报文发的，最小发送单元是报文，所以 **从报文角度来看** 没有类似流水线的操作。

#### iii. 分组交换

将一个报文划分成多个 **格式统一** 的分组，然后对分组进行 **存储-转发**。（分组大小应该是远小于完整报文的大小，所以可以仿照流水线加速）

假设每个分组的大小为 $x$ 比特，共有 $m$ 个分组，中间经过 $n$ 个路由器跳转，链路带宽平均为 $b\ bps$，传播时延为 $d\ s$，那么传播总时间为：$\dfrac{x}{b} \times (m+n) + d$。

### 3. 计算机网络的主要性能指标：带宽、时延、利用率

#### i. 带宽

现在的带宽指 **数字信道** 传送的最高数据率（等同于 **数据在通路上的发送速率**）。**带宽也叫吞吐量**。单位现在一般为 `bps`。

#### ii. 时延

指一个报文 / 分组从一个网络 / 链路的 **一端传输到另一端所需的时间**。

总时延 = 发送时延 + 传播时延 + 处理时延，其中需要注意的是：

* **信号传输速度 != 信号在信道上的传播速度**。传输是传输，和带宽有关；传播是传播，和物理介质与波的属性有关；
* 发送时延（又称传输时延）指 **从开帧的第一个比特开始发送算起，到最后一个比特从节点进入链路之间的时间**。发送时延 = 数据帧长度 / 带宽；
* 传播时延 = 信道长度 / 电磁波在信道上的传播速率；
* 处理时延一般会直接给出，因为它是 **存储-转发** 过程中 **必要花费的时间**。**排队时延是处理时延的重要组成部分**。

#### iii. 利用率

信道利用率指 **信道有百分之几的时间被利用**，而这个 “利用” 指的是 “发送端向链路中发送数据”：

$$
\alpha = \dfrac{\frac{l_1}{c_1}}{\frac{l_1}{c_1} + 2 \times R + \frac{l_2}{c_2}}
$$

其中：

* $l_1$ 为发送端在一个发送周期中所发送的比特数；
* $l_2$ 为接收端回应的确认帧长；（一般和 $l_1$ 相同）；
* $c_1$ 为发送端的数据传输率；
* $c_2$ 为接收方的数据传输率；（一般与 $c_1$ 相同）
* $R$ 为单向传播时延。

完全空闲的信道利用率为 0。而信道 **利用率一旦提高**，**信道引起的时延也就迅速增加**：

$$
D = \dfrac{D_0}{1-U}
$$

由此可见，**信道利用率并非越高越好**。一般计算的时候，可能会忽略某些时延。哪怕信道的利用率已经非常高了，也会忽略它们。

此处 $D_0$ 为空闲时的时延，$U$ 为信道利用率。

### 4. 数据链路层滑动窗口

数据链路层全双工数据传输使用滑动窗口进行流量控制和差错控制：选择重发 `ARQ` 协议和退后 `N` 帧 `ARQ` 协议。

考试的话，估计就是让画出故障之后的图。

#### i. 后退 N 帧的 ARQ 协议

协议掺在一起不好说，还是应该分开叙述。

发送方是后退 `N` 帧的主角。其用 `x` 个比特维护着一个滑动窗口，大小为 $2^x$；对窗口内每个单元都维护一个超时计时器；还存有期待的 **`ACK` 序号**：

* 当上一层传下数据后，检查窗口是否已满，如果未满则下界滑动窗口（唯一滑动下界的地方）；
* 当向下一层传数据时，备份发送的数据，并非直接销毁（以备重传）；
* 当收到下一层传来的 `ACK` 后，销毁 **编号对应的帧及其前所有未销毁的帧** 的备份，上界滑动窗口（唯一滑动上界的地方）；
* 当窗口内某个单元的计数器超时，立刻利用帧备份，重发所有 **已发送但未收到确认帧** 的帧。

接收方的戏份比较少，其同样有一个滑动窗口，但大小固定；同时接收方维护一个期待的 **帧序号**：

* 当下一层传上数据后，滑动窗口 **已满则丢弃**，若帧序号 **不符合期待也丢弃**，并且返回 **ACK-已接收的最大帧序号**。如果满足则下界滑动窗口（唯一滑动下界的地方）；
* 当帧处理结束后，发送对应的 `ACK`，上界滑动窗口（唯一滑动上界的地方）。

也就是说，接收方只接受顺序到达，此外所有情况均丢弃。

#### ii. 选择重发 ARQ 协议

总的来说，大致过程和 **后退 N 帧** 没有特别大的差异。选择重发也用计时器，也用滑动窗口。可它们还是有不同点的，比如 `NAK`，比如乱序接收，比如帧缓存。但二者最重要的不同点是：“**选择重发 ARQ 协议只需要重传那一个超时的帧，而后退 N 帧很可能重传很多帧**”。

我们考的这个选择重发协议应该和网上的有些不太一样。

选择重发 `ARQ` 协议在不考虑 `NAK` 的时候，允许非顺序的接收。并且 **接受了就返回一个** `ACK`，因此必须维持一个缓冲区。由于是乱序接收，对于数据链路层的上一层，每次并非上传一个数据，而是上传一整个窗口的数据。

比如，现在接收窗口覆盖的有 “0,1,2,3”，现在接收到了 1 和 2，那么即使 0 到了，也不移动窗口 / 向上一层上传。需要等到 3 号到达，也就是 **整个窗口的所有帧序号都到达了**，**才会移动窗口**。

假设 3 在发送端定时器超时，也不会像之前 **后退 N 帧** 时一样发送很多帧，仅仅只会发送序号为 3 的帧。

##### 补：带 NAK 的选择重发 ARQ 协议

书上说了 **选择重传策略通常跟否定策略结合起来一起使用**。那很有可能考试考的就是结合起来使用。

详情可见书 188 页的下半页：

```chinese
当接收方有理由怀疑出现了错误时，它就给发送方返回一个否定确认（NAK）帧。
……
NAK 中指定了要重传的帧。
……
如果 NAK 被损坏了，或者丢失了，则不会有实质性的伤害。
因为发送方最终会超时，无论如何它都会重传丢失的帧。
```

在看课件的时候，我们经常会被眼花缭乱的时序图蒙蔽了双眼，脑子里面乱乱糟糟。实际上我只需要明白 “**NAK 是插件，而非主体功能**” 就好。

没了 `NAK`，照样可以选择重发；有了它，只不过是令其效率更高罢了。`NAK` 令协议少了些耐心——接收方凡是看到了不符合期望的，都会返回 `NAK`，尤其序号错乱时。（因为接收方很有理由怀疑 “序号错乱就是帧丢失导致的”）

### 5. 千兆以太网设计

交换机、路由器、服务器、主机、网卡、要求高可靠性（冗余设计），会画出拓扑结构图、计算各网络设备的数量，知道交换机内的 `Spanning Tree` 算法的作用，了解实现负载均衡的常用分组调度算法，例如 `FQ` 等。

可以看看计网最后一个实验的拓扑图。

### 6. 利用 `M/M/1` 排队模型分析服务器平均响应时间

会灵活应用公式：$T = \dfrac{1}{服务率-到达率}$。

### 7. 广播路由算法（重点掌握后面两个，计算广播生成的分组数）

这个 **分组** 是什么东西呢？就是网络里面的数据包。一个路由器接收到分组后，转发分组，需要注意的是用于转发的新分组并非之前接收到的分组。

#### i. 逐一发送

准备好所有的目标地址，目标地址有多少个就在 **最开始** 发多少个分组。

分组们在遇到路由器时，根据路由表走不同的转发路线。

#### ii. 多目标路由

目标地址列表写到了分组中，分组中有完整的路线。于是每条链路上只有一个分组。

#### iii. 泛洪法

计算起来比较恶心人。我的建议是只看节点。

对于一个给定的路由器，假设它可能接收 $n$ 个方向的数据包，仔细想想它到底在过程中可能会接收哪几个方向的报文：

* 如果只接受一个方向的，那么它就会在网络中新产生 $n-1$ 个分组；
* 如果接收多个方向的，那么它就会在网络中新产生 $n$ 个分组（在这个算法中，路由器不会向 **同一条链路** 发 **多个相同** 的分组）。

最后加起来就行了。

#### iv. 逆向路径转发

做题的时候，题目要么给路由表，要么给 **Sink Tree(汇集树)**。

泛洪还是该泛洪，但是对于某些泛洪分组，路由器是不进行响应的。也就是说，不响应非常用链路上的分组 **会大大减少常用链路上的分组个数**（也就是在常用链路上的废物分组）。

需要注意的是，要人为判定 **哪些链路是常用于转发分组的**。

#### v. 生成树广播路由

离散讲过生成树。在一个网络中，生成树随着选取的 **根节点** 的不同而不同。

源计算机发送一个分组，那么中间的路由器都会通过源地址知晓 **该选择哪一个生成树**。

使用生成树广播路由时，网络中的分组数是最少的。

### 8. 隧道技术：掌握原理，会具体应用

隧道可用于 **连接两个不同的网络**。

隧道的建立，至少需要两个实现了双 / 多协议栈的路由器，由这个双 / 多协议栈路由器将原报文作为 `payload` 装在新协议中，并在新的网络中传输。

### 9. 流量整形技术：漏桶、令牌桶、令牌桶+漏桶

明确各技术的用途、算法、会计算各部分时间：突发、平稳、空闲。

漏桶和令牌桶是两个设计思路。

漏桶重在一个 “漏” 字，“漏” 就代表了处理的速率，桶里的 “水” 就是分组。这个漏口的大小一般来说是相对固定的，那么漏桶就使得流量的 **输出十分平缓**。**分组可被丢弃**（从上面漏）也是漏桶相对于令牌桶的特点。

令牌桶重要的 “令牌”。这个桶不漏底，桶接的的不是水，而是源源不断产生的令牌。一个报文只有获取了对应的令牌，才能够被处理。而令牌是有一定数目的，这就使得令牌桶能够 **容忍突发流量**，也就是 **随时间累计(verb)发送能力**。

```chinese
1. 计算标称值：
计算机以 25MB/s 速率产生数据，路由器最大工作速率为 2MB/s。
数据以每秒有 40ms 的突发数据输入。为平稳输出。

每秒突发产生的数据量为：25MB/s × 40ms = 1MB
令桶空的最小速率为：1MB / 1s = 1MB/s
桶大小至少为 1MB，漏桶速率可在 1MB/s~2MB/s 范围内。
```

```chinese
2. 计算全速传输时间：
令牌桶整形，填充速率为 1Mbps。初始令牌桶填满，为 8MB。
求计算机能以 6Mbps 全速传输多久。

1t + 64Mb = 6t
t = 64 / 5 = 12.8s
```

```chinese
3. 计算持续最大数据率：
令牌桶整形，每 5 us 一个令牌，一个令牌放行一个 48B 的数据。
求最大可持续数据率。

每秒产生令牌数：1s / 0.000005s = 0.2M/s
最大可持续数据率：48B × 0.2M/s = 76.8Mbps
```

漏桶主要为 **平稳输出**，令牌桶为 **允许突发流量**（也会导致平稳输出）。漏桶还可以和令牌桶一起使用，达到 **平稳输出、允许突发流量、减小速率峰值** 的效果。

这个漏桶怎么接呢？实际上就是 **令牌桶仍以最大速率运行，但将令牌桶处理的数据放入漏桶中**。这样即允许突发，又不至于突发的时候立刻满载。

```chinese
计算机以 25MB/s 速率产生数据，每秒有 40ms 突发数据输入。
为平稳输出、允许突发流量和减少速率峰值。
令牌到达率为 2MB/s，桶容量为 500KB，漏桶速率 10MB/s。
求每秒令牌桶+漏桶工作时间。

首先令牌桶满令牌满速率工作，对于漏桶而言，漏桶中增加的速率为：25MB/s - 10MB/s = 15MB/s
这段时间长度为：500KB + 2MB/s × t = 25MB/s × t，t = 21.73ms
此后令牌桶发射速度为 2MB/s，但漏桶还会以 10MB/s 消耗数据，总共是按 8MB/s 消耗。
这段时间的长度为：21.73ms × 15MB/s = t × 8MB/s，t = 40.74ms
总共加起来是 21.73ms + 40.74ms = 62.47ms

后面就不需要更多说明了。
```

### 10. 分组调度算法：重点掌握 `WFQ`，计算分组输出次序

这个调度算法和正常人的大脑电波不在一个频道上。无论是 **FQ** 还是 **WFQ**，都是要 **按字节扫描** 各队列。也就是说：

**处理时间** 不仅仅和分组的到达时间有关系，更与 **分组的长度** 有关系。（如果是 **WFQ** 的话，还会与 **队列权重** 有关系，权重用于 **加快** 扫描速度）

```chinese
假设 A,B,C 三个队列的权重分别是 1,1,2，有如下分组信息：

分组 到达时间 长度
 A      0      8
 B      5      6
 C      5      10
 D      8      9
 E      8      8
 F      10     6
 G      11     10
 H      20     8

对于 A 分组，其应处理时间应该是 0+8 = 8。
但是仅仅计算出应处理时间，并不能确定 A 的次序，还需要算出其他的时间：

分组 扫描完成时间
 A    0+8 = 8
 B    5+6 = 11
 C    5+10/2 = 10
 D    8+9 = 17
 E    8+8/2 = 12
 F    10+6 = 16
 G    11+10/2 = 16
 H    20+8 = 28

所以排序是：A C B E F G D H
```

有时候可能用 “具体编程实现” 的说法更好理解：可把对每个队列的维护都看作一个进程，队列 **每进入一个新的报文**，都会 **开启一个新线程** 进行扫描。一旦扫描结束，就把这个报文 `enqueue` 到一个 “多个队列间共享” 的总队列（虚拟的，不存在，只供理解）中。

### 11. 路由器的 IP 数据报转发过程（划分子网）

太简单了。

### 12. `Internet` 一次通信中 IP 地址、物理地址、端口地址的使用

如常用端口（80）的使用。在哪层使用？每层的数据单位叫什么？在经过的网络中如何变化（**IP** 地址和端口地址保持不变，但物理地址每经过一个网络都需改变，物理地址由 `ARP` 协议获得）

#### i. 端口的使用

端口是传输层中使用的，其存在于传输层协议中。

#### ii. 每层的数据单位

物理层中叫 “比特流”；数据链路层中叫 “帧”；网络层中叫 “包”；传输层中叫 “段(TCP) / 数据报(UDP)”。

#### iii. `Internet` 网络层通信过程

见第五章课件 134 页和 135 页。

网络层协议是不同网络之间的粘合剂。

* 从传输层获取数据，封装成 `IP` 数据包，发送到 `Internet` 中；
* 中间的路由器根据 **IP 协议中的目标地址** 查找路由表，并转发，直到目的地；
* 从收到的 **IP 协议** 中获取数据，转交给传输层。

#### iv. 物理地址 / IP 地址 / 端口地址的使用

见第五章课件 140 页到 142 页。最关键的想必是 144 页的总结。

物理地址具有全球唯一性，就是 `MAC` 地址、网卡地址，是网络中对一个计算机寻址时使用的地址。在通信中通过 `ARP` 协议获得。

而 `IP` 地址的用法很模糊，我也一时说不清楚，只能说是用于锁定一台主机。

端口地址适用于标识 **一台主机中进程** 使用的地址。

### 13. ARP 协议：用途、工作过程，分组中的地址如何使用

`ARP (Address Resolution Protocol)` 是 **以太网** 使用的地址解析方式，用途：**将 IP 地址映射到其对应的物理地址**。

主机和路由器中都有一个 `ARP` 表，表中是 **IP 地址到物理地址的映射**。如果需要地址解析，那么就执行以下步骤：

* 查找当前机器中的 `ARP` 表，如果有就返回，如果没有：
* 在本网络中广播 **ARP 请求分组**，收到广播的主机检查自己的 `ARP` 表，如果有就 **单播 ARP 响应分组**。

无论是 **ARP 请求分组**，还是 **ARP 响应分组**，都有发送主机自己的 **IP 地址和物理地址**，接收到分组的主机，都会缓存下这个组合到自己的 `ARP` 表中。

如第五章课件 247 页所言，如果 **目标主机和源主机不在一个局域网中**，那么就需要通过 `ARP` 询问本局域网内的某个路由器，让路由器转发 **IP 包** 到另一个网络中去。

### 14. 网络配置：IP 参数配置、DHCP 服务器

**IP** 参数的配置（可用地址、子网掩码、默认网关等）、**DHCP** 服务器（工作原理，工作过程中 **IP** 地址应用，例如：封装 **DHCP Discover** 报文的 **IP** 数据报的源 **IP** 地址和目的 **IP** 地址分别是什么），注意特殊 **IP** 地址的使用，例如：本机地址、广播地址、网络地址等。

**IP** 参数在这道题中可能就是考察三个：

* 自定义 `IP` 地址；
* 子网掩码；
* 默认网关。

唯一需要说明的是 **默认网关**。如果不设置这个东西，就假定此后的通信不出当前子网（不与外部网络通信）。若是想与外界网络通信、多个子网间通信，那么一定要写默认网关。（并且这个默认网关的 `IP` 一定要是该路由器在本子网内的 `IP` 地址）

封装 **DHCP Discover** 报文的 **IP** 数据包的 **源 IP 地址** 自然就是发送方，也就是 **DHCP Client** 所在的主机 **IP 地址**；而目的地址则是该网络中的广播地址（主机号全 1）。

### 15. TCP 中的拥塞控制

掌握工作原理，会计算每轮的拥塞窗口和慢开始门限，注意区分慢开始和拥塞避免、快重传和快恢复两种方法。

* 慢开始就是从 1 个开始发，但是指数增长。“慢” 体现在一开始一次性只发 1 个报文；
* 拥塞避免是在 **超过阈值** 后线性增长的策略；
* 快重传是收到 **连续 3 个重复的 ACK** 之后，重传下一序号的策略，此后，**慢启动阈值** 被设置为 **当前拥塞窗口的一半**；
* 快恢复是不减到 1，只减一半。

## 填选复习范围

* 1 到 9：物理层
* 10 到 26：数据链路层 / 介质访问控制子层
* 27 到 34：网络层
* 35 到 36：传输层

### 1. 计算机网络的常用分类（2 种分类方法）

* 按传输技术分类
  * 广播式网络
    * 就是广播，一个机器发，其他所有机器接受；
    * 所有机器连在一条大通路上。
  * 点到点式网络
    * 一个机器传给另一个机器，按照 **存储-转发** 原理传输；
    * 适合远距离的传输。
* 按距离大小分类
  * $1m$：`Personal Area Network`;
  * $10m \to 1km$：`LAN`;
  * $10km$: `MAN`;
  * $100km \to 1000km$: `WAN`;
  * $10000km$: `Internet`.

### 2. C/S 和 B/S

#### i. C/S

只有客户端和服务器。客户端发起请求，服务端响应。
（说是：“独立性强，单独升级客户机或服务器不影响正常工作；优化网络利用率” 我都不知道为啥不影响正常工作）

#### ii. B/S

三层结构：浏览器/服务器/数据库。
减轻了系统维护成本，降低了用户总体成本，用户不再需要安装客户端。

### 3. 常用电子商务形式

* B2B：商家对商家，阿里巴巴；
* B2C：商家对客户，订书网站；
* C2C：客户对客户，闲鱼；
* P2P：对等系统，共享网盘；
* OTO：线上到线下，苏宁。

### 4. 协议分层思想、分层后的数据传输

采用结构化设计(`structed design`)，也就是划分层次：

* 发送端从高层传输到底层，逐层封装。
* 接收端从底层传输到高层，逐步解封。

相同层间，看似水平传输。但实际上需要那一层向下或向上传输。相同层获得的不直接来自其他机器的同层，而是来自于本机器的下一层或上一层。

### 5. OSI 7 层

太简单了。

### 6. TCP/IP 4 层

太简单了。

### 7. 信道容量的含义和计算

信道容量的定义就是 **信道的最大信息传输速率**。

说容量，很可能让人以为它的单位是 `byte` 或者 `bit`。甚至可能让人误以为它指的是网络中可容纳的最大数据量。

但实际上它表示的是速率（`bps`）。

#### i. 有限带宽无噪声信道

$H$ 为低通信道的带宽。

* **理想低通信道** 的最高码元传输速率：$B = 2H$。
* **理想低通信道** 的最高比特传输速率：$C = B \log_2{N} = 2H \log_2{N}$。

虽然说是 $\log_2{N}$，但实际上这个对数值等于 **一个码元是由 $n$ 个比特组成的** 的这个 $n$。

课件里面这个 “四级数字信号” 属实把我整懵了。算了，说是可以代入到 $N$ 那就代。

#### ii. 有限带宽高斯分布噪声信道

香农公式：$C = H \log_2(1+\dfrac{S}{N})$

$S/N$ 是信噪比：$x\ dB = 10 \log_{10}(S/N); S/N = 10^{\frac{x}{10}}$

### 8. 传输介质：双绞线、光纤、通信卫星

我就不知道这玩意儿要咋考？？？

### 9. 基本调制技术：ASK、FSK、PSK

调制是使 **一种波形的某些特性** 按 **另一种波形或信号** 变化的过程或处理方法。

具体咋做的肯定是没要求，主要是对三个图有印象：物理层课件 92 页到 94 页：

* ASK: amplitude 振幅;
* FSK: frequency 频率;
* PSK: phase 相位.

也就是说，**0** 和 **1** 在这三种调制技术调制后，会呈现不同的特征，如振幅一个高一个低、频率一个大一个小、相位相反。

### 10. CRC：作用、算法、生成多项式的实现（硬件）

#### i. 作用

这玩意儿是 “线性” 检错码。

#### ii. 算法

异或。把被除数和除数都想象成有限域内多项式，做的除法是多项式的模 2 除法。由于是多项式，**低位和高位之间有不可逾越的次数差距**，不存在什么进位和借位。

* 一开始，如果除数有 $n$ 位，就往 **被除数** 后面接 $n-1$ 个 **0**。
* 接着，模 2 除法，除到 **被除数无法落位到最新余数后面**。
* 最后，舍弃 “商”，用 $n-1$ 位的 **最新余数** 填补那一开始接上的 $n-1$ 个 **0**，目的是做到 **将余数加到被除数上，使 (被除数+余数) 可以被除数整除**。

#### iii. 电路

这个考完了可以说一下。

### 11. 海明码：纠正一位错的冗余位设计（会计算所需冗余位数）

海明码是纠错码，想要纠 $d$ 比特的错，就得使用海明距离为 $2d+1$ 的编码。

$k$ 是数据位长度，$r$ 为校验位长度，$n$ 为码字位数：

那就一个公式：$(k+r+1) \le 2^r$。

证明如下：

码字是什么？就是信道一次发送的东西，码字位数就是一次发送的东西的位数。里面真实传输的数据位数就是数据位长度；不是信息位的长度总和就是校验位长度。

什么叫 **非法码字**？就是在某种检错码机制下，在传输中不应该出现的码字。由于有 $n$ 位码字，所以 $2^k$ 个可能的有效数据中的每一个，都会有 $n$ 个海明距离为 1 的非法码字。

$n$ 位总共有 $2^n$ 中可能数据，每个有效数据对应一种校验，也就是说有 $2^k$ 种合法码字。上面说了，$2^k$ 中的每一个都会有 $n$ 个非法码字，所以加起来就是 $1+n$ 种比特模式。

总的来说有这么一个限制：$(1+n)2^k \le 2^n$。这是必然的，因为必须小于，$2^n$ 可是总数了！

### 12. 组织网络和传感器网络的移动性、电耗控制

找不到，不知道是哪里的。

组织网络对移动性的要求高，传感器网络对电耗控制的要求高。

### 13. 多路复用技术的原理与比较，CDMA 要计算接收数据

多路复用的意思就是把 **同一条通信链路** 分出多条 “子路”，并且同时传输信号。

* FDM：频分多路复用，载波带宽被划分为多种不同频率带的子信道，多个子信道间可以并行传送数据，也就是用不同频率传送各路消息，实现多路通信。
* TDM：时分多路复用，用不同信道或时隙的交叉位脉冲，在同一个媒介上传输多个数据。
* WDM：波分多路复用，用不同波长的光载波信号，经复用器汇在一起，在同一根光纤中传输多种波长的光信号。
* CDM / CDMA：码分多路复用，用不同的编码格式编码 0 和 1，发送方合并，接收方分离。

有关 `CDMA` 计算接收数据，就是接收方的解码分离过程。

假设这里有两个不同的发送端，它们各自维护一个 **芯片序列**。

* 当它想要发送 **1** 的时候，就 **直接发送这个序列**；
* 当它想要发送 **0** 的时候，就 **发送芯片序列的反码**。

1. 检验：对两个不同发送端的 **芯片序列** 做内积。如果 **内积为 0**，则可以发送；
2. 发送：将两个不同发送端 **想要发送的序列** 直接线性相加；
3. 解码：将发送端 **芯片序列** 和接收到的结果一起做 **规格化内积**，得到的结果为 1，那么就是 1；如果是 -1，那就是 0。（“规格化内积” 就是要除以模长）

```chinese
比如 A 端使用 (+1,-1,-1,+1,+1,+1,-1,-1)，B 端使用 (-1,+1,-1,+1,-1,+1,+1,-1)。
如果接收到的数据为 (-2,+2, 0, 0,-2, 0, 0,+2)，那么 A/B 二端传输的分别是什么。

  (-2,+2, 0, 0,-2, 0, 0,+2)
  (+1,-1,-1,+1,+1,+1,-1,-1)
= (-2 + -2 + 0 + 0 + -2 + 0 + 0 + -2) / 8 = -1，所以 A 传的 0

  (-2,+2, 0, 0,-2, 0, 0,+2)
  (-1,+1,-1,+1,-1,+1,+1,-1)
= (2 + 2 + 0 + 0 + 2 + 0 + 0 + 2) / 8 = 1，所以 B 传的 1
```

### 14. 数据链路层成帧的四种方法

* 字节计数法
* 字节填充的标志字节法
* 比特填充的标志比特法
* 物理层违禁编码法

连续的 5 个 1 之后，必定接着 1 个 0。这是因为它的头尾都是 0x7e。

### 15. 自动重发请求协议 (ARQ) 确认+定时器+帧编号

这是差错控制里面的。

发送方发送数据，接收方接受之后进行检测：

* 如果对，就让对方继续发；
* 如果错，就让对方重发。

* **确认** 就是让对面继续发的那个 `ACK`；
* **定时器** 用来防止永远不响应自己还傻等的情况出现；
* **帧序号** 防止接收方对此收到同一帧。

### 16. 滑动窗口协议与停-等协议、后退 N 帧协议、选择重传协议的关系

#### i. 停-等协议

发送窗口 = 1；接收窗口 = 1。

#### ii. 后退 N 帧协议

接收端只保存 1 个期望的帧序号，也就是说只盯着一个序号看，其他的都丢弃。由于接收窗口大小为 1，因此后退 `N` 帧保证了 **帧的有序到达**。

发送窗口 > 1；接收窗口 = 1。

#### iii. 选择重传协议

由于选择重传并不一定要求有序到达，接收窗口的大小大于 1。

发送窗口 > 1；接收窗口 > 1。

且两窗口大小一定要小于 $2^{n-1}$，$n$ 为帧序号。

### 17. PPP 协议的组成

特点是不可靠传输。需要注意的是这道题可能考 **计算协议帧的长度**。

|名称|F|A|C|协议|信息部分|FCS|F|
|-|-|-|-|-|-|-|-|
|内容|7E|FF|03|不定|IP 数据报|不定|7E|
|长度|1|1|1|1 或 2|不超过 1500 字节|2 或 4|1|

这个长度都是按字节来分的。有一些 `Optional` 的长度，那都是可协商的。

对于协议部分：

* 最高位为 0：说明信息部分是网络层协议；
* 最高位为 1：说明信息部分是 **PPP 的配置协议**。

协议部分 **默认是两个字节**，但是可以通过 **LCP 协议** 协商到一个字节。

信息部分在无协商情况下，默认是 1500 字节。在不足时，通过填充补足空余部分。可以通过 **LCP 协议** 协商成任意大小。（是吗？）

校验和字段一般是 2 个字节，但可以被 **LCP 协议** 协商成 4 个字节。

所以一个 **PPP** 帧，默认为 $(1+1+1+2+1500+2+1) = 1508$ 字节；最小可协商为 $(1+1+1+1+0+2+1) = 7$ 字节；最大可为 $(1+1+1+2+1500+4+1) = 1510$ 字节。

### 18. CSMA/CD：思想、本质、会最短帧长的计算

首先，这里再复述一下 **CSMA/CD** 的思路：

* 发消息前进行检测，如果无冲突，则（等待最小间隔后）发送；
* 发送时，也要时刻检测链路上是否发生冲突（通过检测 “链路上传输出去的信号是否与读回的信号是否相同” 来判断）；
* 一旦检测到冲突，就立刻停止发送，隔随机的一段时间后，开始做第一步。

**帧间的最小间隔** 为 $9.6 \mu s$。

也就是说，检测到总线空闲后，也还至少需要等待 $9.6 \mu s$ 才能再次发送数据。（但这个在计算 “最短帧长” 的时候并不重要）

最重要的是第二点：**发送时，也要时刻检测链路上是否发生冲突**。可以设发送端到接收端的传播时延为 $\tau$。假设现在 **在链路上某点** 发生了确确实实的冲突，可是发生冲突的时候，**无论是发送端，还是接收端**，都还 **不知道冲突的发生**（光速限制）。

由于 “**通过检测读回信号判断是否冲突**”，至少要等到 **接收方数据** 传到 **发送方** 时，**发送方** 才知道冲突的发生。

相较于 **发送方发送出数据的那一刻**，要经过 $2\tau-\delta$ 的时间，自己才知道冲突的发生（$\delta$ 是一个变量，与接收方发送数据的时间有关，$\delta \in [0, \tau]$）。

但是，很有可能帧太短了，以至于 **帧发送完毕之后，才把有关帧的冲突传回来**。这个时候发送方肯定是不认的。所以需要设置一个 **最短帧长**。

最短帧长就是需要 **发送发还在发送它的时候，接收到了有关它的冲突**。

```chinese
1km 电缆建立一个 1Gbps 速率的 CSMA/CD 网络。信号在电缆上传播速率为 200000km/s。求最短帧长。

2 × (1km / 200000km/s) = x / 1Gbps，x = 10000bit
```

### 19. 自适应树遍历协议：会计算通信时隙数

在书上的 212 页，课件第四章 49 页。

题目差不多会给一个树，然后说那两个节点同时想要发送数据。然后问第几个时隙有节点获得信道。

对于一个树节点（非叶子节点相当于一个 **槽**，包括根节点），它冲突的条件是 **其下所有叶子节点中，有两个以上节点同时想要发送数据**。比如课件上的就是 **G, H** 同时想要发送，进而导致 **1, 3, 7** 节点冲突。

需要注意的是，**时隙 0** 也算在内，意为 **检测到根节点冲突**。同时，对一个节点的检查可看作 **需要消耗一个时隙的时间**，对根节点的检查也是。因此对课件上的例子，也就有：

* 时隙 0：检测到根节点冲突；
* 时隙 1：检测 2 节点，无请求；
* 时隙 2：跳过节点 3，直接检测 6 节点，无请求；
* 时隙 3：跳过节点 7，直接检测 G 节点，为站点，直接令 G 获得信道。

最后再强记一个公式，$i = \log_2(q)$，$q$ 为发生冲突的叶子节点数目，$i$ 为开始遍历的最优层级（根节点算第 0 级），因为第 $i$ 层的非叶子节点，其下叶子节点占整个树的 $2^{-i}$，期望 $q \times 2^{-i} = 1$。

### 20. 以太网产品的分代

这谁知道咋考啊？课件 54 页到 117 页都是讲以太网分代。

我只知道分为 **传统以太网、快速以太网、千兆以太网、10 G 以太网**。

* 快速以太网：是传统以太网的快速版，100 Mbps；
* 千兆以太网：1 Gbps，仍与以太网标准向后兼容，同时支持半双工和全双工；
* 10 G 以太网：还是保持向后兼容，全双工通信，不使用 CSMA/CD。

### 21. MAC 地址：格式和应用

|名称|前导码|dst|src|长度/类型|数据|填充|FCS|
|-|-|-|-|-|-|-|-|
|长度|8|6|6|2|0~1500|0~46|4|
|备注|DIX全是1010，802.3有7字节同步码和一字节定界符|全球唯一|全球唯一|区分 XIC/802.3 的唯一字段|无|和数据的总和一定要大于46字节|无|

8 字节前导码，包括 7 字节同步码和 1 字节的 **MAC 帧开始** 定界符。

**MAC 帧** 里面首先是目标地址和源地址，都是 **MAC 地址**，各占 6 个字节。此后是类型或长度，再次是最小 46 字节、但最大 1500 字节的数据，后跟检验和。

* 类型字段的值都大于 1500（实际上是 1536），所以限制了数据段必须小于 1500。
* 必须要有 **填充** 来确保帧的总长度大于 64 字节。不然很有可能 “发生了冲突，但由于帧太短，整个发送过程提前结束，而不响应、处理冲突”。

### 22. 以太网交换机的交换方式、工作过程、总带宽的计算

以太网交换机见第四章课件 94 页，书上的 264 页。

以太网交换机有很多 “可供一端连接计算机节点的双绞线直接插入” 的端口。每个端口都在交换机内部设有一个 **缓冲器**，缓冲器好似一个队列，用于存储交换机还未来得及处理的帧。交换机中维护着一个 **端口-地址表**，对于每个从 **缓存器** 中获取的 **帧**，都可以使用 **帧中物理地址**，判断该送往哪个端口。

这是交换机的总架构，根据对 **帧** 处理方式的不同，又可以分成如下三种交换方式。

#### i. 存储-转发

交换机内部有缓冲区，使用 **存储-转发** 方式进行转发。收到发送过来的数据，先把它存在缓冲区中，在缓冲区中可以检测帧是否有差错；由于使用了缓冲区，可以轻松做到不同速率端口间的转发。

#### ii. 切入法

检测到地址后马上转发，不检错，也不存起来。

好处就是快。

#### iii. 改进型切入法

综合前两者，不存储，但是会进行一些处理：

将帧的前 64 字节，检查是否有误。如果无误，立刻转发（这就很奇怪，它是怎么检查的？）

#### iv. 计算总带宽

我猜测题目大概会给出交换机中各端口的吞吐量，然后算理论总带宽（“线速背板带宽”）。或者反过来：

```chinese
如果以太网交换机的总带宽为 8.4Gbps,并且有 22 个全双工百兆端口,则全双工千兆的端口最多为？

全双工千兆口数为 (8.4Gbps - 22 × 2 × 0.1Gbps) / (2 × 1Gbps) = 2
```

### 23. 以太网中的冲突域和广播域

网桥隔离冲突域，路由器隔离广播域。

### 24. 解决 WIFI 网络屏蔽站或暴露站的技术关键

第四章课件 128 页和 129 页；141 页和 142 页。

这里简单介绍一下 `CSMA`：

**1-坚持** 分为三个过程：

* 看繁忙与否，不繁忙直接发，繁忙则等待；
* 这个等待是死等，一直检测链路，**一旦空闲**，**立刻发送**；
* 如果这个发送出了冲突，那就 **随机** 等一段时间再发。

**p-坚持** 是如果空闲，就以概率 $p$ 发送数据。

**非坚持** 比较符合一般人类的思维：

* 看繁忙与否，不繁忙直接发，繁忙则下一步；
* 等待随机时间，回到第一步。

第二层常用的 `CSMA` 只能知道发送站想要发送数据时，其周围的信道占用情况，并根据监听到的情况决定自己的动作（发送还是等待）。

`WIFI` 是无线的，不能检测正在发生的冲突，而且 **需要获取接收站周围信道占用的情况**。

使用 **MACA** （冲突避免多路访问）技术：

* 请求方发送一 **RTS** 帧，监听到该帧的所有站点全部停止向请求方发送数据，以确保请求方收到的只是响应方的帧；
* 响应方发送一 **CTS** 帧，听到该帧的所有站点全部停止向响应方发数据，并且沉默相当长时间，确保响应方附近没有冲突，响应方只能接受到请求方的数据。

### 25. IEEE 802.11 组网方式

课件上没有，我猜测是书上 231 页的 **有架构模式 / 分布式系统** 和 **自组织系统**。

有架构模式，就是客户端接入 **AP**，不同 **AP** 又互相连接，每个数据包都会经过 **AP**。自组织模式是客户间直接发帧，没有接入点。

但也有可能指的是 **组织网络** 和 **传感器网络**。

### 26. IEEE 802.11 的 MAC 协议：DCF 和 PCF

总的来说：

* DCF (Distributed Coordination Function)：分布式接入，让各站争用信道，从而获得发送数据的权力；
* PCF (Point Coordination Function)：轮询法，理论上无竞争，所有的带宽由一个全局 **Point** 控制，将发送数据的权力轮流交给各个站点。

**DCF 以 CSMA/CA 作为默认接入方式**，有关的内容应该看 **CSMA/CA**，而非深究 **DCF**。

这两个玩意儿 **PCF** 是可选的接入方式，而 **DCF** 是必选的。（但我并不懂可选/必选是什么意思）

### 27. 层次路由，会计算路由表中的表项数

就是对于一个路由器而言，它如果能和整个网络中的所有路由器通信，需要多少表项。

* 首先，任意路由器必须有其区域中 **所有路由器** 的地址；
* 其次，任意路由器必须有一个到 **同层次其他区域** 的地址；
* 最后，任意路由器必须按照第二条规则，拥有其他所有大层次（簇/区/群）的地址。（按照题目分析）

但总的来说，最重要的就是 **确保每台路由器都可以和网络中任何一个路由器通信**。

### 28. 组播路由中的核心基本树

要求会计算使用 / 不使用核心基本树网络所需保存的树的数目。

#### i. 不使用核心基本树

一个子网里面有 $n$ 个组，假设每个组平均有 $m$ 个成员。那么如果 **不使用核心基本树**，网络中每个路由器需要存储 $mn$ 棵不同的树。

**“每个路由器都要存 $mn$ 棵树”** 这件事可能很难理解。其实是这样的：

路由器要做的事情无非是告诉 **任意** 数据包下一跳该去往何方。对于一个路由器来说，如果它只存路由表，肯定不能做到按组播树传播。因为按路由表走，它只会按 `Dijkstra` 给出的路线走。所以路由器必须要存组播树。（按照我的理解的话）

对于某一个节点来说，**以它为起点** 的 **某一个组** 的组播树，与 **同组中其他节点** 的组播树（也以它们自己为起点）一定不一样。（为什么不一样？不说别的，网络中任意两个节点的最小生成树能一样吗，如果不一样的话，组播树为什么会一样）

上面说了，路由器不能按照路由表去找下一跳。

对于一个 **IP 包**，里面是记录了 `src` 与 `dst` 的。想要按照组播树路线走，那只能让路由器通过包中给出的 `src & dst` 查找 **自己已经存储好的组播树**。而同组的组播树，又因 **起点的不同而各不相同**，对于一个 $m$ 个成员的组，网络中的路由器只能被迫记住 $m$ 个组播树。若整个网络中有 $n$ 个组的话，就必须记住 $nm$ 个组播树了。

#### ii. 使用核心基本树

如果使用 **核心基本树**，原理是令同组不同节点的组播树强制相同。

组中发送数据，必须先发到一个核心节点，然后再由核心节点转发到那个节点。

所以对于一个有 $n$ 个组的网络，无论每个组中有多少成员，每台路由器都只需要存储 $n$ 个组播树。

### 29. 移动主机的路由选择：三角路由

按照课件的说法，**每个移动主机都有一个永久的家乡地址**。

这里会有一个叫做 **家乡代理** 的服务，它一直待在 “家乡”。移动主机到了一个地方，会主动向家乡代理 **注册** 自己新的位置。

这样，当下一次有机器向移动主机发送数据时，家乡代理可以通过 **隧道** 转发分组。在移动主机接到 **来自家乡代理** 的数据包时，会拆开隧道封装，获取内部报文，直接响应内部报文的 `src`。

此后，发送者会通过 **隧道** 绕过家乡代理，直达真实目标地址。

如果把机器和机器之间看成 “端到端”，那么课件上的第 1 步到第 4 步就不仅仅是逻辑上的三角，也是物理上的 “三角”。

### 30. RSVP 协议

**RSVP** 是服务质量一节中 **综合服务体系结构** 中的协议。

允许多个发送方对多个接收方。允许接收方自由切换频道。

路由器并不在意接收方到底在看什么，路由器只关心它和接收方的 **协商**。如果新频道同意之前的协商（要求的参数小于先前的协商参数），那就什么都不用做。

需要注意的是：

* 和日常生活中看视频一样，这里是 **接收方选择数据源**。接收方在协商时可以做有关 **“未来是否有更换数据源”**、**“资源预留协商完成后，资源参数是否固定不变”** 的讨论；
* 多个接收方可以共享一条路径；
* 两个不同源肯定用两条完完全全独立的信道，哪怕它们有部分相同的路径；
* 同源会在末稍处用两条独立的信道，但如果 **它们有部分相同的路径**，那么在那些路径上都是 **用同一条信道**；
* 是接收方在最开始 **请求** 发送方发送；

### 31. IPv4 地址，注意私有地址和特殊地址

#### i. 私有网 IP 地址

见课件第五章 160 页，按传统分类地址方法：

|类|网络号|网络总数|地址总数|
|-|-|-|-|
|A|10.0.0.0|1|$2^{24}$|
|B|172.16.0.0~172.31.0.0|16|$2^{20}$|
|C|192.168.0.0~192.168.255.0|256|$2^{16}$|

#### ii. 特殊 IP 地址

见课件第五章 153 页。

|种类|Netid|Hostid|用作源地址|用作目的地址|
|-|-|-|-|-|
|网络地址|特定|全0|不可|不可|
|直接广播地址|特定|全1|不可|不可|
|受限广播地址|全1|全1|不可|可以|
|本网络上的本主机|全0|全0|可以|不可|
|本网络上的特定主机|全0|特定|可以|可以|
|环回地址|127|任意|不可|可以|

### 32. CIDR：重点掌握路由聚合和最长前缀匹配的使用和应用

为方便表示网络中不定长度的子网掩码，用 **CIDR(Classless Inter-Domain Routing)** （画斜线表示掩码）的标记方法来代替 **网络号+子网号**。

那么很明显，在路由器中，应该用 **最长前缀匹配** 方式来决定某包的下一跳地址。（如果不是最长前缀，那就飞到其他子网里面了，第一步走错后，不可能在那个 **非最长前缀** 的子网中找到目标子网）

**链路聚合** 与划分子网几乎是相反的，它是把多个 “长前缀” 的子网合并成一个 “短前缀” 的网络。这样路由器不需要存所有 “长前缀” 子网，而只需要存一个个 “短前缀”，存的东西会少一些。我猜这部分的题目肯定是给几个地址，然后问链路聚合之后的 “短前缀” 是多少之类的……

### 33. 路由器、路由表和路由选择

#### i. 路由表

|掩码|目的地址|下一跳|标志|引用计数|使用|接口|
|-|-|-|-|-|-|-|
|255.0.0.0|124.0.0.0|145.6.7.23|UG|4|20|m2|
|...|...|...|...|...|...|...|

这是课件上的例子。

每一项就是一个包 / 一个流 / 多个流所走的路由。对于 **标志** 一栏，有以下标识可选：

* U (use)：这一条路由记录可以工作；
* G (gateway)：**我在这条路由记录中扮演网关**，并将其转发到其他子网中；
* H (host)：这一条路由记录 **被我直接指定了特定主机地址**。

我们管有 `G` 叫 **间接交付**，反之，被称为 **直接交付**。（都 **连在这个路由器** 上，自然就由 **当前** 这台路由器 **直接交付** 给了目标网络）

我们管有 `H` 叫 **特定主机**，反之，被称为 **特定网络**。（特定主机就是那个 **目的地址** 是主机实际 `IP`，而非主机 **所在网络** 的 **网络地址**）

做题的时候，可以把 路由器的路由表 手动按照上面的过程要求去排序：

* 最上面的：`U` / `UH`（无 `G` 代表是直连的）
* 中间的：`UGH`（有 `H` 说明是特定主机）
* 下面的：`UG`（`UG` 代表特定网络）
* 最下面的：`0.0.0.0 | UG`（默认路由）

#### ii. 路由选择

1. 从收到的 `IP` 数据包首部提取目的 `IP` 地址 `dst`。
2. **先判断是否直接交付**。用与路由器 **直接相连** 的网络的子网掩码和 `dst` 相与，检查结果是否和网络地址匹配。
3. **判断是否能特定主机路由**。如果路由表中有 **目的地址为 dst** 的 **特定主机路由**，就传给指明的下一跳路由器。
4. **判断是否能特定网络路由**。用路由表中各特定网络路由的子网掩码与 `dst` 相与，检查结果是否和目的网络地址匹配。
5. **判断是否能默认路由**。如果有默认路由，就传给默认路由指定的下一跳路由器。
6. 报错。

总体，要保持这样三个精神：

1. 先看近，再看远；（能直连就不要间接连接）
2. 先看主机，再看网络；（能特定主机就不看特定网络）
3. 默认路由优先级最小。（最后处理默认路由）

### 34. RIP 协议、OSPF 协议和 BGP 协议所使用的路由算法

#### i. RIP 协议

使用距离矢量算法。

#### ii. OSPF 协议

使用 **链路状态算法** 进行网络抽象，用 **Dijkstra 算法** 寻找最短路径、构建路由表。

#### iii. BGP 协议

这是在不同 **AS** 之间交换 **路由信息** 的协议。

采用 **路径向量算法** 进行路由选择。

### 35. TCP 协议的流量控制

**动态滑动窗口协议** 可以同时实现 **流量控制和拥塞控制**。

对于流量控制，具体体现在：**发送端窗口大小取决于接收端可用的缓冲区容量**。

### 36. TCP 协议的连接建立和连接释放的具体过程

经典的三次握手、四次挥手：

```chinese
Host1                       Host2
SYN, seq=x        ------>
                  <------   SYN, seq=y, ACK=x+1
seq=x+1, ACK=y+1  ------>
```

双方各自发送自己的 `seq`。返回的确认帧 `ACK` 是 `seq+1`。

有必要说明，`seq` 是 **已发送的最后一个段的序号**，`ACK` 是 **期望对方发送的下一个段的序号**。

这里从多个角度理解三次握手：

三次握手可以防止 **发起者旧、重复连接请求**，也就是 **失效的连接请求报文段突然传到接收方** 造成的问题。

三次握手中，由 **接收端向发送端发送** 的 `ACK`，是为了告诉发送端，自己已经接收到了发送端发来的第一个 `SYN`；而 **发送端向接收端发送的第二次** `ACK` 则是告诉接收端，自己收到了对方发来的 `SYN+ACK`。也就是说：**后面的两次，都是在告诉对方，“我收到了上一条信息”**。

三次握手是最小限制，当然可以四次握手、五次握手。但是 3 是建立一个单向连接的最小数。建立连接需要什么？

* 对于发送方而言，需要的是 **接收方知道自己想要建立连接**；
* 对于接收方而言，需要的是 **自己知道发送方明确自己允许建立连接**。

由此也就是三次握手。当然也可以四次握手，而四次握手的后三次，可以看作是 **“前三次握手的接收方” 发起的 “新三次握手”**。因此，四次握手可以建立两个方向相反的单向连接。

释放连接时的四次挥手：

```chinese
Host1                          Host2
seq=x, FIN            ------>
                      <------  ACK, seq=v, ack=u+1

                      <------  FIN, ACK, seq=w, ack=u+1
ACK, seq=u+1, ack=w+1 ------>
```

为什么需要四次？是因为 `TCP` 连接的释放是 **对称释放**，也就是 “你释放你的，我释放我的”，双方 **独立决定** 是否应该释放连接。

接收端的 `ACK` 和 `FIN` 是分开发的，这是因为 `TCP` 协议要求：**接收端在得知发送端不再发送后，也仍能接收发送端发送的包**。（因为路上可能还有没到的）当接收端确定不会再收到发送端发来的包后，才会发送 `FIN`，关闭自己的接收能力。
