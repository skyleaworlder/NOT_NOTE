# Port / TargetPort / NodePort

备忘：

* `Port` 是节点内部访问时所使用的 `Port`；
* `TargetPort` 是节点内部的 `Pod` 暴露出来的 `Port`；
* `NodePort` 是节点外部访问某特定服务需要指定的 `Port`。

感觉网上好多都是在讲概念，没说清楚过。

## 客户端眼中的 NodePort

个人觉得，从抽象角度来讲，一个外部想要使用 **服务** 的客户，不应该知道内部杂七杂八的 `Addr:Port`。

> 因此集合了许多的服务，封装成一个 **节点**。
> 当然这么说是很有问题的，因为 **服务** 并不是最小的可操作单元，并且服务不如 `Pod`，服务下的 `Pod` 是可以不在同一个节点的，而 `Pod` 下的容器却只能在一个节点内。

对于外部的客户端来说，重要的只是一个 **从 Port 到 服务 的映射表**。

| Port | Service |
|-|-|
| :10080 | svc1 |
| :10081 | svc2 |
| :10082 | svc3 |
| ... | ... |

其他都不是客户端关心的。

## 节点内的 Port

对于节点内的诸多 `Pod` 而言，想要完成功能大多是需要与其他 `Pod` 构成的 **服务** 交互的。能够独立提供服务的应该比较少吧。

那么对于每一个服务而言，或者说是服务下的 `Pod` 而言，重要的只是一个 **从 Port 到其他服务的映射**。

而这个映射和客户眼里的映射表是不同的。
（但就我现在对 `K8s` 的学习情况，我觉得挺没必要的）

知道了这么一张映射表，节点内的某个服务也可以享受其他服务。**而服务是可以跨节点的**，因此通过这张映射表，可以获取整个 `K8s` 集群中的所有服务。

## Pod 的 TargetPort

这个最简单，就是 `Pod` 暴露给外界的，用于访问自身内进程的。

比如：

```bash
kubectl run xxx --image=skyleaworlder/xxx --port=6666
```

那么这个 `--port=6666` 就是后面可以 `describe` 出来看到的 `TargetPort`。并且，这个端口需要和 `Pod` 内部执行的程序绑定。

如果内部有一句：

```go
conn := net.Listen("tcp", ":8080")
```

但是外面还是 `--port=6666`，那就接不到了。

## 总之

客户该看到什么，不该看到什么，我觉得如果按我这个理解的话，是能够解释 `Port` / `NodePort` / `TargetPort` 的区别的。
